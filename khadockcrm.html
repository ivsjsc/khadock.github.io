<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý khách hàng - KhaDock.com</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --sidebar-bg: #2d3748;
            --sidebar-text: #e2e8f0;
            --sidebar-active-bg: #4a5568;
            --content-bg: #f7fafc;
            --text-dark: #2d3748;
            --text-light: #718096;
            --border-color: #e2e8f0;
            --modal-shadow: rgba(0, 0, 0, 0.2);
            --danger-color: #e53e3e;
            --success-color: #48bb78;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            background-color: var(--content-bg);
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background-color: #ffffff;
            border-bottom: 1px solid var(--border-color);
            padding: 0 2rem;
            height: 60px;
            display: flex;
            align-items: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
            flex-shrink: 0;
        }

        .app-container {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
        }

        nav {
            width: 240px;
            background-color: var(--sidebar-bg);
            padding: 1.5rem 0;
            flex-shrink: 0;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        nav a {
            display: block;
            padding: 0.75rem 2rem;
            color: var(--sidebar-text);
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s;
            border-left: 3px solid transparent;
        }

        nav a:hover {
            background-color: var(--sidebar-active-bg);
        }

        nav a.active {
            background-color: var(--primary-color);
            border-left-color: var(--sidebar-text);
        }

        main {
            flex-grow: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active-tab {
            display: block;
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }
        
        .controls-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .search-box input {
            width: 300px;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .table-container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        thead {
            background-color: #f1f5f9;
        }

        th {
            font-weight: 600;
        }
        
        td .btn-action {
            padding: 0.25rem 0.5rem;
            margin-right: 0.5rem;
            font-size: 0.875rem;
            border-radius: 4px;
        }
        
        .btn-edit {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-delete {
            background-color: var(--danger-color);
            color: white;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px var(--modal-shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">KhaDock.com - Quản lý khách hàng</div>
    </header>

    <div class="app-container">
        <nav>
            <ul>
                <li><a href="#" class="active" data-tab="customers">Khách hàng</a></li>
                <li><a href="#" data-tab="quotations">Báo giá</a></li>
                <li><a href="#" data-tab="invoices">Hóa đơn</a></li>
            </ul>
        </nav>

        <main class="tab-content active-tab" id="customers">
            <h2 class="section-title">Danh sách khách hàng</h2>
            
            <div class="controls-container">
                <div class="search-box">
                    <input type="text" id="customerSearch" placeholder="Tìm kiếm theo tên hoặc mã KH...">
                </div>
                <button id="addCustomerBtn" class="btn btn-primary">Thêm mới</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Mã KH</th>
                            <th>Tên khách hàng</th>
                            <th>Email</th>
                            <th>Số điện thoại</th>
                            <th>Địa chỉ</th>
                            <th>Nguồn</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="customerTableBody">
                        </tbody>
                </table>
            </div>
        </main>

        <main class="tab-content" id="quotations">
            <h2 class="section-title">Quản lý báo giá (Chưa phát triển)</h2>
        </main>

        <main class="tab-content" id="invoices">
            <h2 class="section-title">Quản lý hóa đơn (Chưa phát triển)</h2>
        </main>
    </div>

    <div class="modal-overlay hidden" id="customerModalOverlay">
        <div class="modal" id="customerModal">
            <div class="modal-header">
                <h3 id="customerModalTitle">Thêm khách hàng</h3>
                <button class="btn-close" id="closeCustomerModalBtn">&times;</button>
            </div>
            
            <form id="customerForm">
                <input type="hidden" id="customerIdField">
                <div class="form-group">
                    <label for="customerName">Tên khách hàng</label>
                    <input type="text" id="customerName" required placeholder="Nhập tên">
                </div>
                <div class="form-group">
                    <label for="customerEmail">Email</label>
                    <input type="email" id="customerEmail" placeholder="Nhập email (tùy chọn)">
                </div>
                <div class="form-group">
                    <label for="customerPhone">Số điện thoại</label>
                    <input type="tel" id="customerPhone" required placeholder="Nhập số điện thoại">
                </div>
                <div class="form-group">
                    <label for="customerAddress">Địa chỉ</label>
                    <textarea id="customerAddress" rows="2" placeholder="Nhập địa chỉ"></textarea>
                </div>
                <div class="form-group">
                    <label for="customerSource">Nguồn nhận biết</label>
                    <select id="customerSource">
                        <option value="">-- Chọn nguồn --</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Google Search">Tìm kiếm Google</option>
                        <option value="Friend recommendation">Bạn bè giới thiệu</option>
                        <option value="Email marketing">Email Marketing</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Lưu lại</button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elements ---
            const customerTableBody = document.getElementById('customerTableBody');
            const addCustomerBtn = document.getElementById('addCustomerBtn');
            const customerModalOverlay = document.getElementById('customerModalOverlay');
            const customerModalTitle = document.getElementById('customerModalTitle');
            const closeCustomerModalBtn = document.getElementById('closeCustomerModalBtn');
            const customerForm = document.getElementById('customerForm');
            const customerIdField = document.getElementById('customerIdField');
            const customerSearch = document.getElementById('customerSearch');
            const navLinks = document.querySelectorAll('nav a');

            // --- Data Management ---
            let customers = JSON.parse(localStorage.getItem('customers')) || [];

            const saveCustomers = () => {
                localStorage.setItem('customers', JSON.stringify(customers));
            };

            // --- Render Functions ---
            const renderCustomerTable = (customerList) => {
                customerTableBody.innerHTML = '';
                if (customerList.length === 0) {
                    customerTableBody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding: 2rem;">Chưa có khách hàng nào.</td></tr>`;
                    return;
                }
                customerList.forEach(customer => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${customer.code}</td>
                        <td>${customer.name}</td>
                        <td>${customer.email}</td>
                        <td>${customer.phone}</td>
                        <td>${customer.address}</td>
                        <td>${customer.source}</td>
                        <td>
                            <button class="btn btn-action btn-edit" data-id="${customer.id}">Sửa</button>
                            <button class="btn btn-action btn-delete" data-id="${customer.id}">Xóa</button>
                        </td>
                    `;
                    customerTableBody.appendChild(row);
                });
            };

            // --- Modal Functions ---
            const openModal = (mode = 'add', customer = null) => {
                customerForm.reset();
                if (mode === 'add') {
                    customerModalTitle.textContent = 'Thêm khách hàng mới';
                    customerIdField.value = '';
                } else if (mode === 'edit' && customer) {
                    customerModalTitle.textContent = 'Cập nhật thông tin khách hàng';
                    customerIdField.value = customer.id;
                    document.getElementById('customerName').value = customer.name;
                    document.getElementById('customerEmail').value = customer.email;
                    document.getElementById('customerPhone').value = customer.phone;
                    document.getElementById('customerAddress').value = customer.address;
                    document.getElementById('customerSource').value = customer.source;
                }
                customerModalOverlay.classList.remove('hidden');
            };

            const closeModal = () => {
                customerModalOverlay.classList.add('hidden');
            };

            // --- Event Handlers ---
            const handleFormSubmit = (e) => {
                e.preventDefault();
                const customerData = {
                    id: customerIdField.value ? parseInt(customerIdField.value) : Date.now(),
                    name: document.getElementById('customerName').value,
                    email: document.getElementById('customerEmail').value,
                    phone: document.getElementById('customerPhone').value,
                    address: document.getElementById('customerAddress').value,
                    source: document.getElementById('customerSource').value,
                };

                if (customerIdField.value) { // Edit mode
                    customers = customers.map(c => c.id === customerData.id ? { ...c, ...customerData } : c);
                } else { // Add mode
                    const nextCode = `KH${(customers.length + 1).toString().padStart(4, '0')}`;
                    customerData.code = nextCode;
                    customers.push(customerData);
                }

                saveCustomers();
                renderCustomerTable(customers);
                closeModal();
            };

            const handleTableClick = (e) => {
                const target = e.target;
                const id = parseInt(target.dataset.id);

                if (target.classList.contains('btn-edit')) {
                    const customerToEdit = customers.find(c => c.id === id);
                    if (customerToEdit) openModal('edit', customerToEdit);
                }

                if (target.classList.contains('btn-delete')) {
                    if (confirm(`Bạn có chắc chắn muốn xóa khách hàng này không?`)) {
                        customers = customers.filter(c => c.id !== id);
                        saveCustomers();
                        renderCustomerTable(customers);
                    }
                }
            };

            const handleSearch = () => {
                const searchTerm = customerSearch.value.toLowerCase();
                const filteredCustomers = customers.filter(c =>
                    c.name.toLowerCase().includes(searchTerm) ||
                    c.code.toLowerCase().includes(searchTerm)
                );
                renderCustomerTable(filteredCustomers);
            };

            const switchTab = (e) => {
                e.preventDefault();
                navLinks.forEach(link => link.classList.remove('active'));
                e.target.classList.add('active');

                const tabId = e.target.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active-tab');
                });
                document.getElementById(tabId).classList.add('active-tab');
            };
            
            // --- Initial Setup ---
            const initialize = () => {
                // Populate with sample data if empty
                if (customers.length === 0) {
                    customers = [
                        { id: 1, code: 'KH0001', name: 'Nguyễn Văn A', email: 'a@example.com', phone: '0123456789', address: '123 Đường ABC, TP. HCM', source: 'Facebook' },
                        { id: 2, code: 'KH0002', name: 'Trần Thị B', email: 'b@example.com', phone: '0987654321', address: '456 Đường XYZ, Hà Nội', source: 'Email marketing' }
                    ];
                    saveCustomers();
                }

                renderCustomerTable(customers);

                // Add Event Listeners
                addCustomerBtn.addEventListener('click', () => openModal('add'));
                closeCustomerModalBtn.addEventListener('click', closeModal);
                customerModalOverlay.addEventListener('click', (e) => {
                    if (e.target === customerModalOverlay) closeModal();
                });
                customerForm.addEventListener('submit', handleFormSubmit);
                customerTableBody.addEventListener('click', handleTableClick);
                customerSearch.addEventListener('input', handleSearch);
                navLinks.forEach(link => link.addEventListener('click', switchTab));
            };

            initialize();
        });
    </script>
</body>
</html>